#!/usr/bin/env bash
set -euo pipefail

# Generated by ansible role: haproxy
# This script runs HAProxy "pre-reload" actions and then reloads HAProxy.

{% set simple_cmds = haproxy_pre_reload_shell_commands | default([]) %}
{% set structured_cmds = (haproxy_pre_reload_actions | default([])) | map(attribute='command') | list %}
{% set all_cmds = simple_cmds + structured_cmds %}

{% if (all_cmds | length) == 0 %}
# No pre-reload actions configured.
{% else %}
{% for cmd in all_cmds %}
{{ cmd }}
{% endfor %}
{% endif %}

{{ haproxy_cron_reload_command }}
