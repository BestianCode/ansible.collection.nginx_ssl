---

haproxy_worker_rlimit_nofile: 1024000

# Global section settings
haproxy_maxconn: 128000

# HAProxy timeouts (defaults section)
# Override per-host/group as needed.
haproxy_timeout_queue: "10s"
haproxy_timeout_client: "300s"
haproxy_timeout_server: "300s"
haproxy_timeout_connect: "10s"

# HAProxy threading.
# If unset, the template defaults to `ansible_processor_vcpus` (or 4 if unavailable).
# Set explicitly per host if you want a stable value.
# haproxy_nbthread: 8

# When set to "yes", tasks/main.yml will restart HAProxy (otherwise it reloads).
#haproxy_restart: "no"

# Commands to run BEFORE HAProxy reload/restart.
#
# Two supported formats:
# 1) Simple list of shell strings (executed in order):
# haproxy_pre_reload_shell_commands:
#   - "umask 077 && cat /etc/letsencrypt/live/example.com/fullchain.pem /etc/letsencrypt/live/example.com/privkey.pem > /etc/letsencrypt/live/example.com/all.pem"
#
# 2) Structured list (supports label/chdir/creates/etc):
# haproxy_pre_reload_actions:
#   - name: "Unified SSL certificate for HAProxy (example.com)"
#     command: "umask 077 && cat /etc/letsencrypt/live/example.com/fullchain.pem /etc/letsencrypt/live/example.com/privkey.pem > /etc/letsencrypt/live/example.com/all.pem"
#     executable: /bin/bash
#     changed_when: false
haproxy_pre_reload_shell_executable: /bin/bash
haproxy_pre_reload_shell_commands: []
haproxy_pre_reload_actions: []

# Optional cron job to periodically run the same pre-reload actions and then reload HAProxy.
#
# The role will deploy a root-owned script and install a cron entry that runs it.
# The script includes BOTH lists: haproxy_pre_reload_shell_commands + haproxy_pre_reload_actions[].command.
haproxy_cron_enabled: false
haproxy_cron_name: "HAProxy pre-reload actions + reload"
haproxy_cron_user: root
haproxy_cron_hour: "1"
haproxy_cron_minute: "10"
haproxy_cron_script_path: /usr/local/sbin/haproxy-pre-reload-actions.sh

# Command executed at the end of the cron script.
haproxy_cron_reload_command: "systemctl reload haproxy"

# Extra HAProxy config stanzas appended verbatim after the global/defaults blocks.
#
# This is intentionally a list of raw strings so you can paste normal haproxy.cfg
# fragments (frontend/backend/listen/userlist/etc).
#
# Keep it empty to deploy only the base config + local admin stats listener.
haproxy_backend_configurations: []

# Manage /etc/logrotate.d/haproxy from this role.
haproxy_logrotate_enabled: true
haproxy_logrotate_path: /etc/logrotate.d/haproxy
haproxy_logrotate_logs:
  - /var/log/haproxy.log
haproxy_logrotate_frequency: daily
haproxy_logrotate_rotate: 7
haproxy_logrotate_missingok: true
haproxy_logrotate_notifempty: true
haproxy_logrotate_compress: true
haproxy_logrotate_delaycompress: true
haproxy_logrotate_postrotate_command: "[ ! -x /usr/lib/rsyslog/rsyslog-rotate ] || /usr/lib/rsyslog/rsyslog-rotate"

# Extra raw logrotate directives appended inside the block.
# Example:
# haproxy_logrotate_extra_options:
#   - maxsize 500M
haproxy_logrotate_extra_options: []

# Optional dedicated cron schedule for HAProxy logrotate config only.
# Useful for sub-daily rotations like hourly or every 6 hours.
# When enabled, the role installs a cron entry running:
#   logrotate -s <state_file> <haproxy_logrotate_path>
haproxy_logrotate_cron_enabled: false
haproxy_logrotate_cron_name: "logrotate haproxy"
haproxy_logrotate_cron_user: root
haproxy_logrotate_cron_minute: "5"
haproxy_logrotate_cron_hour: "*"
haproxy_logrotate_state_file: /var/lib/logrotate/status-haproxy

# Example:
# haproxy_backend_configurations:
#   - |
#       frontend fe_https
#           bind *:443
#           mode tcp
#           default_backend be_app
#
#       backend be_app
#           mode tcp
#           balance roundrobin
#           server app1 10.0.0.10:443 check
#           server app2 10.0.0.11:443 check
